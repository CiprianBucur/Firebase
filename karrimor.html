<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="Karrimor">
		<meta name="author" content="Ciprian">

		<title>Karrimor</title>

		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link href="css/datatables.min.css" rel="stylesheet">
		<link href="css/dashboard.css" rel="stylesheet">
		<link href="css/style.css" rel="stylesheet">
		<script src="js/datatables.min.js"></script>
		<script src="js/firebase.js"></script>
	</head>
	<body>

		<div class="navbar-header navbar-fixed-top navbar-inverse">
			<a class="navbar-brand">Karrimor Products</a>
		</div>

		<div class="container">
		  <div class="row">
			<div class="col-md-1 sidebar">
				<h4>Status: <span id="status">Unknown</span></h4>
				<hr>
				<form class="form-signin">
					<h4>Authentication: </h4>
					<input class="form-control" type="email" id="email" name="email" placeholder="E-mail">
					<input class="form-control" type="password" id="password" name="password" placeholder="Password">
				</form>
				<br>
				<button class="btn btn-default" id="sign_in" name="signin">Sign In</button>
			</div>
			<div class="col-md-10" id="produsele" style="display:none">
				<br><br>
			  <table id="tabel" class="table table-striped table-bordered" cellspacing="0" width="100%">
				  <thead>
					<tr>
					  <th>Poza</th>
					  <th>Pret</th>
					  <th>Nume</th>
					</tr>
				  </thead>
				  <tbody id="detalii">
					<tr align="center"><td colspan="3"><h2>Loading...<span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span></h2><span>Return in 3 minutes.</span></td></tr>
				  </tbody>
				</table>
			</div>
		  </div>
		</div>

		<script>
			var config = {
				apiKey: "AIzaSyB6elNPp-DlmMHOdst6CthF09UdGE4Wark",
				authDomain: "karrimor-6ad7f.firebaseapp.com",
				databaseURL: "https://karrimor-6ad7f.firebaseio.com",
				storageBucket: "",
			};
			firebase.initializeApp(config);
			var sportsProducts = firebase.database().ref().limitToFirst(100);
		
			function init() {
			  firebase.auth().onAuthStateChanged(function(user) {
				if (user) {
					$.logat(true);
					document.getElementById('status').innerHTML = '<font color="green">Signed in</font>';
					document.getElementById('sign_in').textContent = 'Sign out';
					afisareProduse();
				} 
				else {
					//$.logat(false);
					document.getElementById('status').innerHTML = '<font color="red">Signed out</font>';
					document.getElementById('sign_in').textContent = 'Sign in';
				}
			  });
			  document.getElementById('sign_in').addEventListener('click', toggleSignIn, false);
			}

			function toggleSignIn() {
				if (firebase.auth().currentUser) {
					firebase.auth().signOut();
				} 
				else {
					var email = document.getElementById('email').value;
					var password = document.getElementById('password').value;
					firebase.auth().signInWithEmailAndPassword(email, password).catch(function(error) {
						var errorCode = error.code;
						var errorMessage = error.message;
						alert(errorMessage);
						console.log(error);
					});
				}
			}

			function refresh(products) {
				var detalii="";
				for (var i = 0; i < products.length; i++) {
					detalii+='<tr>';
					detalii += '<td><img src = ' + products[i].img + '></td>';
					detalii += '<td><h4>' + products[i].price + " " + products[i].moneda + '</h4></td>';
					detalii += '<td><h4><a href='+ products[i].link + '>' + products[i].name + '</a></h4></td>';
					detalii+='</tr>';
				}
				document.getElementById('detalii').innerHTML = detalii;
				$('#tabel').DataTable();
			}
			
			window.onload = function() {
				init();
			};

			(function($){
				$.logat = function(value) {
					if(value == true) {
						$("#produsele").show();
						$(".form-signin").hide();
					}
					else {
						$("#produsele").hide();
						$(".form-signin").show();
					}

					return this;
				}; 
			})(jQuery);

			function afisareProduse() {
				sportsProducts.once("value", function(snapshot) {
					var data = snapshot.val();
					var prod = [];
					for (var key in data) {
						if (data.hasOwnProperty(key)) {
							var price = data[key].currencysizelarge_price ? data[key].currencysizelarge_price : 'Nu are pret';
							var name = data[key].producttext_link_text ? data[key].producttext_link_text : 'Nu are nume';
							var img = data[key].productimagelist_image ? data[key].productimagelist_image : 'Nu are poza';
							var moneda = data[key].currencysizelarge_price_currency ? data[key].currencysizelarge_price_currency : 'Nu are moneda';
							var link = data[key].productsache_link ? data[key].productsache_link : 'Nu are adresa';
							prod.push ({
								price: price,
								name: name,
								img: img,
								moneda: moneda,
								link: link,
							})
						}
					}
					refresh(prod);
				});
			}
		</script>
	</body>
</html>